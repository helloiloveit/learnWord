(dp1
S'output'
p2
S"<type 'exceptions.KeyError'> u'ask_time'"
p3
sS'layer'
p4
S'/Users/mac/Documents/learnEnglish/applications/welcome/controllers/default.py'
p5
sS'code'
p6
S'# -*- coding: utf-8 -*-\n# this file is released under public domain and you can use without limitations\n\n#########################################################################\n## This is a sample controller\n## - index is the default action of any application\n## - user is required for authentication and authorization\n## - download is for downloading files uploaded in the db (does streaming)\n## - call exposes all registered services (none by default)\n#########################################################################\n\nfrom topic_handler import *\nfrom ai_brain import *\n\n\ndef index():\n    """\n    example action using the internationalization operator T and flash\n    rendered by views/default/index.html or views/generic.html\n\n    if you need a simple wiki simply replace the two lines below with:\n    return auth.wiki()\n    """\n    response.flash = T("Welcome to web2py!")\n    redirect(URL(\'talk\'))\n    return dict(message=T(\'Hello World\'))\n\n\ndef user():\n    """\n    exposes:\n    http://..../[app]/default/user/login\n    http://..../[app]/default/user/logout\n    http://..../[app]/default/user/register\n    http://..../[app]/default/user/profile\n    http://..../[app]/default/user/retrieve_password\n    http://..../[app]/default/user/change_password\n    http://..../[app]/default/user/manage_users (requires membership in\n    use @auth.requires_login()\n        @auth.requires_membership(\'group name\')\n        @auth.requires_permission(\'read\',\'table name\',record_id)\n    to decorate functions that need access control\n    """\n    return dict(form=auth())\n\n\n\ndef talk():\n    print\'start\'\n    #initialize session storage info\n\n    return dict()\n\ndef test_STT():\n    return dict()\n\n\n\n\n\n\ndef handle_user_saying_json():\n    """\n\n    """\n    memory_handler.intialize_db_for_memory()\n\n    import json\n    data = request.vars.keys()[0]\n    json_data = json.loads(data)\n    msg = handle_topic_data(json_data)\n    return msg\n\n\ndef handle_topic_data(json_data):\n    """\n    - check if user start new topic\n    - check if user still talk about same topic\n    """\n    intent = json_data[\'outcomes\'][0][\'intent\']\n    """\n    if session.expected_saying == intent:\n        #get last topic handler\n        #handle old topic\n        msg = handle_intent(session.topic_list[-1], json_data)\n        pass\n    else:\n        #new topic\n        clear_session_info()\n        msg = handle_intent(intent, json_data)\n    """\n    msg = handle_intent(intent, json_data)\n\n    return msg\n\nhandler_dic = {LIKE_SMTH: like_smth_handler,\n               GREETING: greeting_handler,\n               OFFER_HELP: receive_offer_help_handler,\n               TIME_INFO: time_info_handler,\n               INTRODUCE_MYSELF:introduce_myself_handler,\n               ASK_DURATION: ask_duration_handler,\n               ASK_CONTACT_INFO: ask_contact_info_handler,\n               ASK_WHAT_ARE_U_DOING: ask_what_are_u_doing_handler,\n               ASK_HOBBY: ask_hobby_handler,\n               ASK_DISTANCE: ask_distance_handler,\n               ASK_WHY_LIKE: ask_why_like_handler,\n               ASK_HOW_TO_DO: ask_how_to_do_handler,\n               EMOTIONAL_EXPRESSION: emotional_expression,\n               #assistant\n               ASK_WHAT_SHOULD_I_DO: ask_advice,\n               ASK_WHAT_MAKE_HAPPY: ask_what_make_happy\n\n               }\n\ndef handle_intent(intent, json_data):\n    """\n    handle ajax call from user\n    need a better algorithm for handle too many case\n    Exp: When talk about smth...only some intent are epxected . So it will requires less computing power\n    """\n    intent = ai_json(json_data).get_intent(0)\n    if session.scenario_flag == True:\n        """\n        correct AI information should be initialized here\n        """\n        human_object = human_obj(\'ai\')\n\n    #in case there\'s expected intent\n    if memory_handler().get_expected_intent():\n        if intent in memory_handler().get_expected_intent():\n            msg = brain().think_with_expected( json_data)\n            return msg\n        else:\n            msg = \'im expecting you to say about %s \'% (memory_handler().get_expected_intent())\n            return msg\n    else:\n        for topic in memory_handler().get_topic_list():\n            if intent in topic_intent_dic[topic][\'intent\']:\n                msg = brain().think(topic, json_data)\n                return msg\n\n\n    # normal case\n    try:\n        handler = handler_dic[intent]\n        msg = handler(json_data).return_msg()\n        return msg\n    except:\n        print\'not implement this intent yet\'\n        pass\n\n    if intent == TO_GO_SOMEWHERE:\n        msg = handler_go_to_some_where(json_data)\n    elif intent == ASK_AGE:\n        msg = handler_talk_about_user(json_data)\n    elif intent == ASK_NAME:\n        msg = handler_talk_about_user(json_data)\n    elif intent == ASK_JOB:\n        msg = handler_talk_about_user(json_data)\n    elif intent == ASK_OPINION_ABOUT_SOMETHING:\n        #msg = handler_talk_about_user(json_data)\n        msg = ask_opinion_about_sth(json_data).return_msg()\n    elif intent == ASK_WHAT_TO_DO:\n        msg = \'no idea\'\n    elif intent ==  DONT_NO:\n        msg = \'thanks\'\n\n\n\n    #personal assistant\n    elif intent == ASK_WHY:\n        msg = \'youre productive and creative at the airport\'\n\n    else:\n        msg = get_answer(json_data[\'outcomes\'][0][\'intent\'])\n\n\n    #session.topic_list.append(intent)\n    return msg\n\ndef handle_user_saying():\n    return get_answer(request.vars.info)\n\n\n\ndef get_answer(intention):\n    if \'ask_name\' in intention:\n        return \'im Huy\'\n    elif \'ask_relationship\' in intention:\n        return \'im not. But i have a girl friend now\'\n    elif \'ask_if_someone_have_a_meal\' in  intention:\n        return \'im looking forward to my delicious dinner\'\n    elif \'ask_when_have_a_meal\' in intention:\n        return \'i cant remember\'\n    elif \'ask_job\' in intention:\n        return " i\'m a software engineer"\n    elif \'ask_company\' in intention:\n        return "im working for vkx company"\n\n    return \'Sorry, currently i could talk about my job, my age only\'\n@cache.action()\ndef download():\n    """\n    allows downloading of uploaded files\n    http://..../[app]/default/download/[filename]\n    """\n    return response.download(request, db)\n\n\n\n\n\n\n\n\ndef clear_session_info():\n    session.time_to_go = None\n    session.by_what = None\n    session.expected_saying = None\n\ndef handler_go_to_some_where(json_data):\n    intent = json_data[\'outcomes\'][0][\'intent\']\n    entity = json_data[\'outcomes\'][0][\'entities\']\n    value =\'\'\n    if intent != TO_GO_SOMEWHERE:\n        # different intent in topic go_to_somewhere\n        handler = go_to_place(session.place)\n    else:\n        # new request about place\n        place = entity[\'target_place\'][0][\'value\']\n        handler = go_to_place(place)\n    question = handler.handle_user_saying(intent,entity)\n    return question\n\ndef handler_talk_about_user( json_data):\n    intent = json_data[\'outcomes\'][0][\'intent\']\n    handler = talk_about_people(\'huy\')\n    msg = handler.handler_user_saying(intent)\n\n    return msg\n\n\ndef ask_and_get_answer(question):\n    if question ==\'ask about time\':\n        return \'3AM\'\n    elif question ==\'ask method to go\':\n        return \'bike\'\n\ndef handler_user_answer(answer):\n    if answer ==\'3AM\':\n        intention =\'time\'\n        value =\'3AM\'\n        handler = go_to_place(\'\')\n        handler.handle_user_saying(intention,value)\n    elif answer ==\'bike\':\n        intention = \'vehicle\'\n        value = \'bike\'\n        handler = go_to_place(\'\')\n        handler.handle_user_saying(intention,value)\n\n\ndef call():\n    """\n    exposes services. for example:\n    http://..../[app]/default/call/jsonrpc\n    decorate with @services.jsonrpc the functions to expose\n    supports xml, json, xmlrpc, jsonrpc, amfrpc, rss, csv\n    """\n    return service()\n\n\n@auth.requires_signature()\ndef data():\n    """\n    http://..../[app]/default/data/tables\n    http://..../[app]/default/data/create/[table]\n    http://..../[app]/default/data/read/[table]/[id]\n    http://..../[app]/default/data/update/[table]/[id]\n    http://..../[app]/default/data/delete/[table]/[id]\n    http://..../[app]/default/data/select/[table]\n    http://..../[app]/default/data/search/[table]\n    but URLs must be signed, i.e. linked with\n      A(\'table\',_href=URL(\'data/tables\',user_signature=True))\n    or with the signed load operator\n      LOAD(\'default\',\'data.load\',args=\'tables\',ajax=True,user_signature=True)\n    """\n    return dict(form=crud())\n\nresponse._vars=response._caller(handle_user_saying_json)\n'
p7
sS'snapshot'
p8
(dp9
sS'traceback'
p10
S'Traceback (most recent call last):\n  File "/Users/mac/Documents/learnEnglish/gluon/restricted.py", line 217, in restricted\n    exec ccode in environment\n  File "/Users/mac/Documents/learnEnglish/applications/welcome/controllers/default.py", line 289, in <module>\n  File "/Users/mac/Documents/learnEnglish/gluon/globals.py", line 372, in <lambda>\n    self._caller = lambda f: f()\n  File "/Users/mac/Documents/learnEnglish/applications/welcome/controllers/default.py", line 71, in handle_user_saying_json\n    msg = handle_topic_data(json_data)\n  File "/Users/mac/Documents/learnEnglish/applications/welcome/controllers/default.py", line 92, in handle_topic_data\n    msg = handle_intent(intent, json_data)\n  File "/Users/mac/Documents/learnEnglish/applications/welcome/controllers/default.py", line 139, in handle_intent\n    msg = brain().think(topic, json_data)\n  File "applications/welcome/modules/ai_brain.py", line 51, in think\n    reply_data = topic_class(\'ai\').handler(json_data)\n  File "applications/welcome/modules/obj_definition.py", line 288, in handler\n    dic_info = self.answer_topic[intent]\nKeyError: u\'ask_time\'\n'
p11
s.